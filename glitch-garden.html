<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Glitch Garden</title>
<style>
  :root { --sky:#0e0f1a; --earth:#0a0d12; --ui:#141927; --ink:#e8f1ff; --muted:#97a7c0; }
  body { margin: 0; background: linear-gradient(180deg, var(--sky), var(--earth)); color: var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
  .wrap { min-height: 100svh; display: grid; grid-template-rows: auto 1fr auto; }
  header, footer { padding: 12px 16px; background: var(--ui); border-bottom: 1px solid #1f2740; }
  footer { border-top: 1px solid #1f2740; border-bottom: none; display: flex; gap: 8px; align-items: center; }
  h1 { margin: 0; font-size: 1.1rem; }
  .hud { display:flex; gap:16px; align-items:center; font-size: 0.95rem; color: var(--muted); }
  .garden { position: relative; display: grid; place-items: center; padding: 12px; }
  canvas { width: min(900px, 94vw); height: min(520px, 60vh); border: 1px solid #253152; border-radius: 14px; background: #0b0e16; }
  button { background: #0d1320; color: var(--ink); border: 1px solid #2a375a; border-radius: 10px; padding: 10px 14px; cursor: pointer; }
  button:hover { background: #111a2d; }
  .msg { margin-left: 8px; color: var(--muted); }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="hud">
      <h1>Glitch Garden</h1>
      <div>Plants: <span id="plantCount">0</span></div>
      <div>Water used: <span id="waterCount">0</span></div>
      <div>Weirdness: <span id="weird">0%</span></div>
    </div>
  </header>

  <div class="garden">
    <canvas id="c" width="900" height="520" aria-label="A glitched garden canvas"></canvas>
  </div>

  <footer>
    <button id="plant">Plant Seed (P)</button>
    <button id="water">Water All (W)</button>
    <button id="prune">Prune (R)</button>
    <button id="reset">Reset</button>
    <span class="msg">Tip: Click the soil to plant exactly where you want.</span>
  </footer>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const plantCountEl = document.getElementById('plantCount');
const waterCountEl = document.getElementById('waterCount');
const weirdEl = document.getElementById('weird');
const btnPlant = document.getElementById('plant');
const btnWater = document.getElementById('water');
const btnPrune = document.getElementById('prune');
const btnReset = document.getElementById('reset');

let plants = [];
let waterCount = 0;
let weirdness = 0; // 0..100

function rand(a,b){ return Math.random()*(b-a)+a; }
function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX - rect.left) * (canvas.width / rect.width);
  const y = (e.clientY - rect.top) * (canvas.height / rect.height);
  plantSeed(x,y);
});

function plantSeed(x = rand(80, canvas.width-80), y = rand(canvas.height-120, canvas.height-60)) {
  plants.push({
    x, y,
    age: 0,
    height: rand(20, 40),
    hue: rand(80, 160),
    sway: rand(0.5, 1.5),
    petals: Math.floor(rand(3,7)),
  });
  updateHUD();
}
function waterAll() {
  waterCount++;
  // Growth
  plants.forEach(p => {
    p.age += rand(0.5, 1.5);
    p.height += rand(6, 12);
    p.hue += rand(-5, 5);
    p.sway += rand(-0.1, 0.2);
  });
  // Induce glitches proportional to activity
  weirdness = clamp(weirdness + rand(3, 9), 0, 100);
  applyGlitches(weirdness);
  updateHUD();
}
function prune() {
  plants = plants.filter((_,i) => i % 2 === 0);
  weirdness = clamp(weirdness - 8, 0, 100);
  applyGlitches(weirdness);
  updateHUD();
}
function resetGarden() {
  plants = [];
  waterCount = 0;
  weirdness = 0;
  applyGlitches(weirdness);
  updateHUD();
}

function updateHUD() {
  plantCountEl.textContent = plants.length;
  waterCountEl.textContent = waterCount;
  weirdEl.textContent = Math.round(weirdness) + "%";
}

function draw() {
  // background soil gradient with slight noise
  const grd = ctx.createLinearGradient(0, 0, 0, canvas.height);
  grd.addColorStop(0, "#0b0e16");
  grd.addColorStop(1, "#0a0d12");
  ctx.fillStyle = grd;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // soil specks
  for (let i = 0; i < 120; i++) {
    ctx.fillStyle = `rgba(255,255,255,${Math.random()*0.03})`;
    ctx.fillRect(rand(0,canvas.width), rand(canvas.height-120, canvas.height), 1, 1);
  }

  // draw plants
  const t = performance.now()/1000;
  plants.forEach(p => {
    const sway = Math.sin(t * p.sway + p.x*0.01) * 6;
    // stem
    ctx.lineWidth = 3;
    ctx.strokeStyle = `hsl(${p.hue}, 40%, 55%)`;
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
    ctx.quadraticCurveTo(p.x + sway, p.y - p.height/2, p.x, p.y - p.height);
    ctx.stroke();

    // flower
    const fx = p.x + sway*0.6;
    const fy = p.y - p.height - 6;
    for (let i=0;i<p.petals;i++){
      const ang = (i / p.petals) * Math.PI*2 + (t*0.4);
      const px = fx + Math.cos(ang)*8;
      const py = fy + Math.sin(ang)*8;
      ctx.fillStyle = `hsl(${p.hue+rand(-10,10)}, 70%, 70%)`;
      ctx.beginPath();
      ctx.arc(px, py, 5 + Math.sin(t*2+i)*0.8, 0, Math.PI*2);
      ctx.fill();
    }
    // center
    ctx.fillStyle = `hsl(${p.hue}, 40%, 50%)`;
    ctx.beginPath(); ctx.arc(fx, fy, 3.5, 0, Math.PI*2); ctx.fill();
  });

  // gentle CRT-like scanline if weird
  if (weirdness > 0) {
    ctx.globalAlpha = clamp(weirdness/140, 0, 0.4);
    for (let y=0; y<canvas.height; y+=2){
      ctx.fillStyle = "rgba(255,255,255,0.05)";
      ctx.fillRect(0,y,canvas.width,1);
    }
    ctx.globalAlpha = 1;
  }

  requestAnimationFrame(draw);
}

function applyGlitches(level) {
  const body = document.body;
  const wrap = document.querySelector('.wrap');
  // CSS filters intensify with weirdness
  const blur = clamp(level/60, 0, 1.2);
  const sat = clamp(1 + level/80, 1, 1.8);
  const hue = Math.round(level * 0.8);
  body.style.filter = `blur(${blur}px) saturate(${sat}) hue-rotate(${hue}deg)`;

  // random text shifts / letterspacing when high
  if (level > 50) {
    document.querySelector('h1').style.letterSpacing = Math.round(level/40) + "px";
  } else {
    document.querySelector('h1').style.letterSpacing = "0";
  }

  // occasional layout nudge
  wrap.style.transform = level > 30 ? `translateY(${Math.sin(performance.now()/300)*2}px)` : "none";
}

function loop() { draw(); }
loop();

// Buttons & keys
btnPlant.addEventListener('click', () => plantSeed());
btnWater.addEventListener('click', waterAll);
btnPrune.addEventListener('click', prune);
btnReset.addEventListener('click', resetGarden);

window.addEventListener('keydown', (e) => {
  if (e.key.toLowerCase() === 'p') plantSeed();
  if (e.key.toLowerCase() === 'w') waterAll();
