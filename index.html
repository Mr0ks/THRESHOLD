<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>THE DOOR</title>
<style>
  :root{
    --boot-bg:#000; --boot-fg:#fff; --intro-red:#d20000;
    --bg:#e9edf2; --panel:#fff; --border:#c7ccd1; --border-dk:#b3b8bd;
    --ink:#222; --muted:#5a6b7a;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font:13px/1.45 system-ui,-apple-system,"Segoe UI",Arial,sans-serif;color:var(--ink);background:var(--bg)}

  /* ---------- BOOT ---------- */
  .boot, .boot2, .progressStage, .intro {
    position:fixed; inset:0; background:var(--boot-bg); color:var(--boot-fg);
  }
  .boot, .boot2, .progressStage {
    font-family: ui-monospace, Menlo, Consolas, monospace;
    padding:14px; overflow:auto; line-height:1.2;
  }
  .bootLine{white-space:pre; font-size:14px; margin-bottom:2px}
  .hidden{display:none!important}
  .progressLine{white-space:pre; font-size:14px}

  /* ---------- INTRO ---------- */
  .intro {
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    background:#000; text-align:center;
  }
  .introSmall {
    color:var(--intro-red);
    font-weight:900; text-transform:uppercase;
    opacity:0; margin:10px 0;
    font-size:clamp(18px,3vw,26px);
    font-family:ui-monospace,monospace;
    transition:opacity 2s ease;
  }
  .title {
    color:var(--intro-red);
    font-weight:900; text-transform:uppercase;
    text-align:center; line-height:.9;
    user-select:none; opacity:0;
    font-size:clamp(56px,16vw,220px);
    transition:opacity 2s ease;
  }
  .fadeIn{opacity:1!important;}
  .fadeOut{opacity:0!important;}

  /* ---------- APP (placeholder) ---------- */
  .app{display:none; place-items:center; height:100%; background:#fff; font-size:24px; font-weight:600;}
</style>
</head>
<body>

<div id="boot" class="boot"></div>
<div id="boot2" class="boot2 hidden"><div class="bootLine">:: Preparing userland…</div></div>
<div id="progressStage" class="progressStage hidden">
  <div class="bootLine">:: Starting The Door environment</div>
  <div class="bootLine">:: Checking services: network OK, display OK, input OK</div><br>
  <div id="pLine" class="progressLine">[                    ] 0%</div>
</div>

<!-- INTRO -->
<div id="intro" class="intro hidden">
  <div>
    <div class="introSmall" id="line1">This game is protected by an MIT license.</div>
    <div class="introSmall" id="line2">This game is based on Wayward and other movies.</div>
    <div class="introSmall" id="line3">Contains flashing lights, loud sounds, and psychological horror.</div>
    <div class="introSmall" id="line4">Loading assets...</div>
    <div class="introSmall" id="line5">Verifying integrity...</div>
    <div class="introSmall" id="line6">Initializing environment...</div>
    <div class="introSmall" id="line7">All systems nominal.</div>
    <div class="introSmall" id="line8">Presenting...</div>
    <div class="title" id="doorTitle">THE DOOR</div>
  </div>
</div>

<div id="app" class="app">[ Mail UI Loaded ]</div>

<script>
const bootEl=document.getElementById('boot'),
      boot2=document.getElementById('boot2'),
      progressStage=document.getElementById('progressStage'),
      intro=document.getElementById('intro'),
      app=document.getElementById('app'),
      pLine=document.getElementById('pLine');

const bootLines=[
 "[    0.000000] Linux version 6.8.1-arch",
 "[    0.002314] Booting system modules...",
 ":: Mounting /dev/sda1 to /mnt/root",
 ":: Starting udevd...",
 ":: Network manager started",
 ":: Boot complete — Press ENTER to continue"
];
let i=0;
function appendBootLine(){
  if(i>=bootLines.length)return;
  const l=document.createElement('div');l.className='bootLine';l.textContent=bootLines[i++];
  bootEl.appendChild(l);bootEl.scrollTop=bootEl.scrollHeight;
  if(i<bootLines.length)setTimeout(appendBootLine,100);
}
appendBootLine();

document.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!bootEl.classList.contains('hidden')){
    bootEl.classList.add('hidden');
    boot2.classList.remove('hidden');
    setTimeout(()=>{
      boot2.classList.add('hidden');
      progressStage.classList.remove('hidden');
      startProgress();
    },800);
  }
});

function startProgress(){
  let pct=0;const total=20;
  const t=setInterval(()=>{
    pct=Math.min(100,pct+Math.floor(Math.random()*8)+5);
    const filled=Math.round((pct/100)*total);
    const bar="["+ "#".repeat(filled).padEnd(total," ")+"] "+String(pct).padStart(2," ")+"%";
    pLine.textContent=bar;
    if(pct>=100){clearInterval(t);setTimeout(()=>{progressStage.classList.add('hidden');startIntro();},300);}
  },120);
}

/* ===== INTRO SEQUENCE ===== */
function startIntro(){
  intro.classList.remove('hidden');
  const audio=new Audio('sounds/intro.mp3');
  audio.volume=1;audio.play();

  const lines=[...document.querySelectorAll('.introSmall')];
  const door=document.getElementById('doorTitle');

  let delay=1000; // first fade
  lines.forEach((line,idx)=>{
    setTimeout(()=>line.classList.add('fadeIn'),delay);
    setTimeout(()=>line.classList.add('fadeOut'),delay+3500);
    delay+=4000;
  });

  // "Presenting..." appears around 25s
  // "THE DOOR" fade-in/out
  setTimeout(()=>door.classList.add('fadeIn'),29000);
  setTimeout(()=>door.classList.add('fadeOut'),36000);

  // Fade audio + show UI at 40s
  setTimeout(()=>{
    const fade=setInterval(()=>{
      if(audio.volume>0.05){audio.volume-=0.05;}else{clearInterval(fade);audio.pause();}
    },200);
    setTimeout(()=>{
      intro.classList.add('hidden');
      app.style.display='grid';
    },2000);
  },40000);
}
</script>
</body>
</html>
