<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>THE DOOR â€” Boot + Intro + Mail UI</title>
<style>
  :root{
    --bg:#e9edf2; --panel:#fff; --border:#c7ccd1; --border-dk:#b3b8bd;
    --ink:#222; --muted:#5a6b7a; --accent:#2a6dce;
    --row-hover:#f3f6f9; --row-select:#cfe8ff;
    --boot-bg:#000; --boot-fg:#fff; --intro-red:#d20000;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:var(--bg);color:var(--ink);font:13px/1.45 system-ui,-apple-system,"Segoe UI",Arial,sans-serif}

  /* ---------- FULLSCREEN STAGES ---------- */
  .stage{position:fixed;inset:0;display:none}
  .show{display:block}
  .bootlike{background:#000;color:#fff;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;line-height:1.2}
  .centered{display:flex;align-items:center;justify-content:center}

  /* Pre-boot text */
  #preboot{font-size:16px}

  /* Boot listing */
  #boot{padding:14px;overflow:auto}
  .bootLine{white-space:pre;font-size:14px;margin-bottom:2px}
  .prompt{margin-top:8px}
  .kbd{display:inline-block;border:1px solid #777;padding:0 6px;border-radius:3px;font-weight:700}

  /* Progress bar */
  #progress{padding:14px}
  .progressLine{white-space:pre;font-size:14px}
  .muted{color:#bbb}

  /* Intro */
  #intro{background:#000;color:#fff;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center}
  .introSmall{color:var(--intro-red);font:14px/1.3 ui-monospace,monospace;opacity:0}
  .title{color:var(--intro-red);font-weight:900;text-transform:uppercase;line-height:.9;opacity:0;
          font-size: clamp(56px, 16vw, 220px); user-select:none}
  .subtitle{color:#bbb;margin-top:18px;font:14px/1.3 ui-monospace,monospace;opacity:0}

  .fadeIn{animation:fadeIn 1s ease forwards}
  .fadeOut{animation:fadeOut 1s ease forwards}
  @keyframes fadeIn{from{opacity:0} to{opacity:1}}
  @keyframes fadeOut{to{opacity:0;visibility:hidden}}

  /* ---------- MAIL UI ---------- */
  .app{display:none;grid-template-columns:220px 1fr;height:100%;border-top:1px solid var(--border)}
  aside{border-right:1px solid var(--border-dk);background:var(--panel);display:flex;flex-direction:column}
  header{padding:10px;font-weight:600;border-bottom:1px solid var(--border)}
  .search{padding:8px 10px;border-bottom:1px solid var(--border)}
  .search input{width:100%;padding:6px 8px;border:1px solid var(--border-dk);border-radius:3px}
  .folders{flex:1;overflow:auto;padding:6px}
  .folder{display:flex;align-items:center;gap:6px;padding:6px 8px;border-radius:4px;cursor:pointer}
  .folder:hover{background:#f6f8fa}
  .folder.active{background:#eaf2ff}
  .folder small{color:var(--muted);margin-left:auto}
  .status{padding:6px 8px;font-size:12px;border-top:1px solid var(--border);background:#f7f9fb;color:#3c4a57}

  main{display:flex;flex-direction:column;background:var(--panel)}
  .toolbar{display:flex;justify-content:flex-end;gap:6px;padding:6px 10px;border-bottom:1px solid var(--border);background:#f7f9fb}
  .btn{background:#eaf0f7;border:1px solid var(--border-dk);border-radius:3px;padding:4px 8px;cursor:pointer}
  .btn:hover{background:#dde7f5}

  .columns{display:grid;grid-template-columns:180px 1fr 100px;font-weight:600;border-bottom:1px solid var(--border);background:#f5f8fc}
  .col{padding:6px 8px;border-right:1px solid var(--border)}
  .col:last-child{border-right:none;text-align:right}

  .list{overflow:auto;border-bottom:1px solid var(--border);flex:1}
  .row{display:grid;grid-template-columns:180px 1fr 100px;align-items:center;cursor:pointer}
  .cell{padding:6px 8px;border-right:1px solid var(--border)}
  .cell:last-child{border-right:none;text-align:right;color:var(--muted)}
  .row:hover{background:var(--row-hover)}
  .row.selected{background:var(--row-select)}

  .readerHead{padding:10px;font-weight:600;border-bottom:1px solid var(--border);background:#fafcfe}
  article{flex:1;overflow:auto;padding:12px}
  article .meta{color:var(--muted);margin-bottom:8px}
</style>
</head>
<body>

<!-- Stage A: Pre-boot -->
<div id="preboot" class="stage bootlike centered show">
  <div class="bootLine">Starting boot sequenceâ€¦</div>
</div>

<!-- Stage B: Boot listing -->
<div id="boot" class="stage bootlike">
  <!-- lines are injected by JS -->
</div>

<!-- Stage C: Progress bar -->
<div id="progress" class="stage bootlike">
  <div class="bootLine">:: Starting userland services</div>
  <div class="bootLine">:: Verifying subsystems: <span class="muted">display OK, input OK, network OK</span></div>
  <br>
  <div id="pLine" class="progressLine">[                    ] 0%</div>
</div>

<!-- Stage D: Intro -->
<div id="intro" class="stage">
  <div class="introSmall" id="line1">This game is protected under the MIT copyright</div>
  <div class="introSmall" id="line2">This game is based on the movie thriller "Wayward"</div>
  <div class="introSmall" id="line3">Inspired by other psychological thrillers</div>
  <div class="title" id="bigTitle">THE DOOR</div>
  <div class="subtitle" id="sub">Based on Wayward and other movies</div>
</div>

<!-- Stage E: App (Mail) -->
<div class="app" id="app">
  <aside>
    <header>Mail</header>
    <div class="search"><input id="q" type="search" placeholder="Search mail"></div>
    <div class="folders">
      <div class="folder active">ðŸ“¥ Inbox <small id="unread">0</small></div>
    </div>
    <div class="status" id="status">Ready</div>
  </aside>

  <main>
    <div class="toolbar">
      <button id="deleteBtn" class="btn">Delete Selected</button>
    </div>
    <div class="columns">
      <div class="col">From</div>
      <div class="col">Subject</div>
      <div class="col">Date</div>
    </div>
    <div id="list" class="list"></div>
    <div id="readerHead" class="readerHead">No message selected</div>
    <article id="reader">
      <p class="meta">Select a message to preview.</p>
    </article>
  </main>
</div>

<script>
/* ============================================================
   AUDIO (robust autoplay handling for GitHub Pages)
   ============================================================ */
const listingAudio = new Audio('/sounds/listing.mp3');
listingAudio.loop = true;
listingAudio.preload = 'auto';

const introAudio = new Audio('/sounds/intro.mp3');
introAudio.preload = 'auto'; // 1 minute track; we'll stop at 40s

// If autoplay is blocked, retry on first user interaction
let audioUnlocked = false;
function tryPlay(a){ a.currentTime = 0; a.play().then(()=>{audioUnlocked=true}).catch(()=>{}); }
function unlockAudio(){
  if(!audioUnlocked){
    try{ listingAudio.play().then(()=>{listingAudio.pause(); audioUnlocked=true}).catch(()=>{});}catch(e){}
    try{ introAudio.play().then(()=>{introAudio.pause(); audioUnlocked=true}).catch(()=>{});}catch(e){}
  }
}
window.addEventListener('keydown', unlockAudio, {once:true});
window.addEventListener('mousedown', unlockAudio, {once:true});
window.addEventListener('touchstart', unlockAudio, {once:true});

/* ============================================================
   STAGE CONTROL
   ============================================================ */
const preboot = document.getElementById('preboot');
const bootEl  = document.getElementById('boot');
const progress= document.getElementById('progress');
const intro   = document.getElementById('intro');
const app     = document.getElementById('app');

function show(el){ el.classList.add('show'); }
function hide(el){ el.classList.remove('show'); }

/* -------------------- A) PRE-BOOT (3s) -------------------- */
show(preboot);
setTimeout(()=>{
  hide(preboot);
  startBootListing();
}, 3000);

/* -------------------- B) BOOT LISTING -------------------- */
const bootLines = [
  "[    0.000000] Linux version 6.8.1-arch (arch@build) (gcc (GCC) 13.2.1) #1 SMP",
  "[    0.003214] Command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=xxxx rw loglevel=3 quiet",
  "[    0.121007] x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'",
  "[    1.287669] core: CPUID marked event: 'cpu cycles' unavailable",
  "[    1.287674] core: CPUID marked event: 'instructions' unavailable",
  "[    1.287677] core: CPUID marked event: 'bus cycles' unavailable",
  "[    1.287679] core: CPUID marked event: 'cache references' unavailable",
  "[    1.287681] core: CPUID marked event: 'cache misses' unavailable",
  "[    1.287683] core: CPUID marked event: 'branch instructions' unavailable",
  "[    1.287686] core: CPUID marked event: 'branch misses' unavailable",
  "Starting systemd-udevd version 256.4-1-arch",
  ":: running early hook [udev]",
  ":: running hook [udev]",
  ":: Triggering uevents...",
  "[    2.104220] input: AT Translated Set 2 keyboard as /devices/platform/i8042/serio0/input/input3",
  "[    2.204220] random: crng init done",
  "",
  ":: Boot complete â€” Press ENTER to continue"
];
let listingDone = false;

function startBootListing(){
  show(bootEl);
  // play listing sound (best effort)
  tryPlay(listingAudio);

  let idx=0;
  const pump = ()=>{
    if(idx>=bootLines.length){ listingDone = true; return; }
    const line = document.createElement('div');
    line.className = 'bootLine';
    line.textContent = bootLines[idx++];
    bootEl.appendChild(line);
    bootEl.scrollTop = bootEl.scrollHeight;

    const delay = (line.textContent==="") ? 200 : 80 + Math.random()*70;
    setTimeout(pump, delay);
  };
  pump();
}

// ENTER to continue from listing
document.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' && bootEl.classList.contains('show')){
    // stop listing sound
    try{ listingAudio.pause(); listingAudio.currentTime=0; }catch(e){}
    hide(bootEl);
    startProgressBar();
  }
});

/* -------------------- C) PROGRESS BAR -------------------- */
const pLine = document.getElementById('pLine');
function startProgressBar(){
  show(progress);
  let pct = 0;
  const slots = 20;
  const tick = setInterval(()=>{
    pct = Math.min(100, pct + Math.floor(Math.random()*10)+4);
    const filled = Math.round((pct/100)*slots);
    const bar = "[" + "#".repeat(filled).padEnd(slots," ") + "] ";
    pLine.textContent = bar + String(pct).padStart(2," ") + "%";
    if(pct>=100){
      clearInterval(tick);
      setTimeout(()=>{ hide(progress); startIntro(); }, 300);
    }
  }, 120); // ~5s average
}

/* -------------------- D) INTRO (1-min track, cut at 40s) -------------------- */
const line1 = document.getElementById('line1');
const line2 = document.getElementById('line2');
const line3 = document.getElementById('line3');
const bigTitle = document.getElementById('bigTitle');
const sub = document.getElementById('sub');

function seqFade(el, start, showFor=3000){
  setTimeout(()=> el.classList.add('fadeIn'), start);
  setTimeout(()=> el.classList.add('fadeOut'), start + showFor);
}

function startIntro(){
  show(intro);

  // Start music; schedule events from musicStart clock
  const musicStart = Date.now();
  const t = (ms)=> Math.max(0, ms - (Date.now()-musicStart)); // safety

  // Attempt to play intro audio
  try{
    introAudio.currentTime = 0;
    introAudio.play().catch(()=>{}); // if blocked, user already pressed Enter, so should be allowed
  }catch(e){}

  // Small red lines with consistent fade timings
  seqFade(line1,  500, 2500);  // 0.5s in
  seqFade(line2,  3500, 2500); // then next
  seqFade(line3,  6500, 2500);

  // THE DOOR at exactly 29s
  const titleAt = 29000;
  setTimeout(()=> { bigTitle.classList.add('fadeIn'); }, titleAt);

  // Subtitle appears a moment after title
  setTimeout(()=> { sub.classList.add('fadeIn'); }, titleAt + 1200);

  // Stop music and fade to UI at 40s
  const endAt = 40000;
  setTimeout(()=>{
    try{ introAudio.pause(); }catch(e){}
    bigTitle.classList.add('fadeOut');
    sub.classList.add('fadeOut');
    setTimeout(()=>{ hide(intro); startApp(); }, 1000);
  }, endAt);
}

/* -------------------- E) APP (MAIL) -------------------- */
const listEl = document.getElementById('list');
const reader = document.getElementById('reader');
const readerHead = document.getElementById('readerHead');
const unreadEl = document.getElementById('unread');
const statusEl = document.getElementById('status');
const q = document.getElementById('q');
const deleteBtn = document.getElementById('deleteBtn');

let messages = [
  {id:'1',from:'HR â€“ Alice',subject:'Welcome to the facility',preview:'Please read carefullyâ€¦',date:new Date().toLocaleString(),body:'<h2>Welcome</h2><p>Please complete all tasks assigned to you.</p>',unread:true},
  {id:'2',from:'Ops â€“ Dana',subject:'Access policy updated',preview:'Your keycardâ€¦',date:new Date(Date.now()-86400000).toLocaleString(),body:'<h2>Access Update</h2><p>Your keycard access has been updated.</p>',unread:true},
  {id:'3',from:'Support',subject:'Ticket #39210 resolved',preview:'We have fixed your issueâ€¦',date:new Date(Date.now()-2*86400000).toLocaleString(),body:'<h2>Ticket Closed</h2><p>Issue resolved. Reply if it reoccurs.</p>',unread:false}
];
let selectedId = null;

function startApp(){ document.getElementById('app').style.display='grid'; renderList(); }

function rowTemplate(m){
  return `<div class="row ${m.id===selectedId?'selected':''}" data-id="${m.id}">
    <div class="cell">${m.from}</div>
    <div class="cell">${m.subject}</div>
    <div class="cell">${m.date}</div>
  </div>`;
}
function renderList(filter=''){
  const f=filter.trim().toLowerCase();
  const filtered=messages.filter(m=>(m.from+' '+m.subject+' '+m.preview).toLowerCase().includes(f));
  listEl.innerHTML = filtered.map(rowTemplate).join('');
  unreadEl.textContent = messages.filter(m=>m.unread).length;
  statusEl.textContent = `${filtered.length} message${filtered.length===1?'':'s'}`;
  listEl.querySelectorAll('.row').forEach(r=> r.onclick = ()=> openMessage(r.dataset.id));
}
function openMessage(id){
  const m=messages.find(x=>x.id===id);
  if(!m) return;
  selectedId=id;
  m.unread=false;
  readerHead.textContent = `${m.from} â€” ${m.subject}`;
  reader.innerHTML = `<p class="meta">${m.date}</p>` + m.body;
  renderList(q.value);
}
deleteBtn.addEventListener('click', ()=>{
  if(!selectedId){ alert('No email selected'); return; }
  messages = messages.filter(m=> m.id!==selectedId);
  selectedId = null;
  readerHead.textContent = 'No message selected';
  reader.innerHTML = '<p class="meta">Select a message to preview.</p>';
  renderList(q.value);
});
q.addEventListener('input', e=> renderList(e.target.value));
</script>
</body>
</html>
