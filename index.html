<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>THRESHOLD</title>
<link rel="icon" type="image/jpeg" href="door.jpg" />
<style>
  :root {
    --boot-bg:#000;
    --boot-fg:#fff;
    --intro-red:#d20000;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body {
    height:100%;
    background:#000;
    overflow:hidden;
    color:#fff;
    font-family:ui-monospace,monospace;
  }

  /* ---------- START SCREEN ---------- */
  .startScreen {
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background:#000; color:#fff; cursor:pointer;
    font-size:clamp(20px,3vw,28px); user-select:none;
    opacity:1; transition:opacity 1.5s ease;
    z-index:20;
  }
  .fadeOut {opacity:0!important;}

  /* ---------- INTRO ---------- */
  .intro {
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background:#000; text-align:center; z-index:10;
  }
  .introText {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    color:#fff;
    font-weight:600;
    text-transform:uppercase;
    opacity:0;
    font-size:clamp(18px,3vw,26px);
    text-align:center;
  }

  @keyframes fadeInOut {
    0% {opacity:0;}
    20% {opacity:1;}
    80% {opacity:1;}
    100% {opacity:0;}
  }
  .fadeInOut {
    animation: fadeInOut 9s ease-in-out forwards;
  }

  /* ---------- PRESENTING + THRESHOLD ---------- */
  .presenting {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    color:#fff;
    font-weight:700;
    text-transform:uppercase;
    font-size:clamp(22px,4vw,40px);
    opacity:0;
  }

  .title {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    color:var(--intro-red);
    font-weight:900;
    text-transform:uppercase;
    white-space:nowrap;
    text-align:center;
    line-height:1;
    opacity:0;
    font-size:clamp(56px,16vw,220px);
  }

  @keyframes presentFade {
    0% {opacity:0;}
    20% {opacity:1;}
    80% {opacity:1;}
    100% {opacity:0;}
  }
  .presentFade {
    animation: presentFade 8s ease-in-out forwards;
  }

  @keyframes titleFade {
    0% {opacity:0;}
    20% {opacity:1;}
    80% {opacity:1;}
    100% {opacity:0;}
  }
  .titleFade {
    animation: titleFade 10s ease-in-out forwards;
  }

  /* ---------- BOOT ---------- */
  .boot, .progressStage {
    position:fixed; inset:0;
    background:var(--boot-bg); color:var(--boot-fg);
    font-family:ui-monospace, Menlo, Consolas, monospace;
    padding:14px; overflow:auto; line-height:1.2;
    display:none;
  }
  .bootLine{white-space:pre; font-size:14px; margin-bottom:2px}
  .progressLine{white-space:pre; font-size:14px}

  /* ---------- APP ---------- */
  .app {
    display:none;
    place-items:center;
    height:100%;
    background:#fff;
    font-size:24px;
    font-weight:600;
    color:#111;
  }
</style>
</head>
<body>

<!-- Start screen -->
<div id="startScreen" class="startScreen">Click anywhere to begin...</div>

<!-- INTRO -->
<div id="intro" class="intro" style="display:none;">
  <div id="introText" class="introText"></div>
  <div class="presenting" id="presentingText">PRESENTING</div>
  <div class="title" id="doorTitle">THRESHOLD</div>
</div>

<!-- Boot -->
<div id="boot" class="boot"></div>
<div id="progressStage" class="progressStage">
  <div class="bootLine">:: Starting THRESHOLD environment</div>
  <div class="bootLine">:: Checking services: network OK, display OK, input OK</div><br>
  <div id="pLine" class="progressLine">[                    ] 0%</div>
</div>

<!-- App -->
<div id="app" class="app">[ Mail UI Loaded ]</div>

<script>
const startScreen=document.getElementById('startScreen');
const intro=document.getElementById('intro');
const introText=document.getElementById('introText');
const door=document.getElementById('doorTitle');
const presenting=document.getElementById('presentingText');
const bootEl=document.getElementById('boot');
const progressStage=document.getElementById('progressStage');
const app=document.getElementById('app');
const pLine=document.getElementById('pLine');

startScreen.addEventListener('click',()=>{
  startScreen.classList.add('fadeOut');
  setTimeout(()=>{
    startScreen.style.display='none';
    startIntro();
  },1500);
});

function startIntro(){
  intro.style.display='flex';
  intro.style.background='#000';
  const audio=new Audio('sounds/intro.mp3');
  audio.volume=1; audio.play();

  const lines=[
    "This game is protected by an MIT license.",
    "This game is based on Wayward and other movies.",
    "Contains flashing lights, loud sounds, and psychological horror."
  ];

  const fadeDuration=9000;
  let delay=0;

  // sequential white text fading
  lines.forEach(text=>{
    setTimeout(()=>{
      introText.textContent=text;
      introText.style.animation='none';
      void introText.offsetWidth;
      introText.style.animation=`fadeInOut ${fadeDuration/1000}s ease-in-out forwards`;
    },delay);
    delay+=fadeDuration;
  });

  // Presenting fades in white, then THRESHOLD in red
  setTimeout(()=>{
    introText.textContent='';
    presenting.style.opacity=0;
    door.style.opacity=0;
    presenting.classList.remove('presentFade');
    door.classList.remove('titleFade');
    void intro.offsetWidth;
    presenting.classList.add('presentFade');
  },27000);

  setTimeout(()=>{
    presenting.style.opacity=0;
    door.classList.add('titleFade');
  },35000);

  // Fade out audio and move to boot
  setTimeout(()=>{
    const fade=setInterval(()=>{
      if(audio.volume>0.05){audio.volume-=0.05;}
      else{clearInterval(fade);audio.pause();}
    },200);
    setTimeout(()=>{
      intro.style.display='none';
      startBoot();
    },2000);
  },45000);
}

/* ===== BOOT ===== */
const bootLines=[
 "[    0.000000] Linux version 6.8.1-arch",
 "[    0.002314] Booting system modules...",
 ":: Mounting /dev/sda1 to /mnt/root",
 ":: Starting udevd...",
 ":: Network manager started",
 ":: Boot complete â€” Press ENTER to continue"
];

function startBoot(){
  bootEl.style.display='block';
  let i=0;
  function appendBootLine(){
    if(i>=bootLines.length)return;
    const l=document.createElement('div');
    l.className='bootLine';
    l.textContent=bootLines[i++];
    bootEl.appendChild(l);
    bootEl.scrollTop=bootEl.scrollHeight;
    if(i<bootLines.length)setTimeout(appendBootLine,100);
  }
  appendBootLine();

  document.addEventListener('keydown',e=>{
    if(e.key==='Enter'&&bootEl.style.display==='block'){
      bootEl.style.display='none';
      progressStage.style.display='block';
      startProgress();
    }
  });
}

function startProgress(){
  let pct=0;const total=20;
  const t=setInterval(()=>{
    pct=Math.min(100,pct+Math.floor(Math.random()*8)+5);
    const filled=Math.round((pct/100)*total);
    const bar="["+ "#".repeat(filled).padEnd(total," ")+"] "+String(pct).padStart(2," ")+"%";
    pLine.textContent=bar;
    if(pct>=100){
      clearInterval(t);
      setTimeout(()=>{
        progressStage.style.display='none';
        app.style.display='grid';
      },300);
    }
  },120);
}
</script>
</body>
</html>
